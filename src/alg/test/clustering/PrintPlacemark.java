package alg.test.clustering;

import java.io.File;
import java.io.FileWriter;
import java.io.PrintWriter;
import java.util.ArrayList;
import java.util.HashMap;
import java.util.Map;


public class PrintPlacemark {

	public static void main (String[]args)throws Exception{
		
     String data = "4.873731700567605,34.81217028622122,0 4.007622891507065,34.9293332696643,0 3.134999848595885,35.04086340652287,0 2.95910870150274,34.5743401056255,0 3.446132089454588,33.86517133412298,0 4.508455245277632,33.25853168636121,0 5.342150444629539,32.99061094182007,0 6.33904089312177,32.70876216007463,0 7.118296966713249,32.45336511095258,0 8.278836628688142,32.14023222061191,0 8.895401416470003,32.67726484974152,0 8.932647061457777,33.29753441056917,0 8.763610575542639,34.1162657778255,0 7.958737042214876,34.55858315047856,0 7.141254434001468,34.99770797531114,0 6.527901690606455,35.07923185870978,0 5.706326632992345,35.18334722857262,0 4.854294571573419,35.14037520052496,0 3.597731807823603,34.65714032170239,0 3.648256668835883,34.00155486927785,0 3.877314195764805,33.33905237902002,0 4.713298358479023,32.76221263131632,0 6.521220193543174,32.21734980319461,0 7.294923263446218,31.96169723882922,0 8.849603396923744,31.90286947116964,0 9.293453563220691,32.77508117880598,0 9.359739651764718,33.86354407288202,0 9.365897165461522,34.51194407785821,0 8.764634803814076,35.58200920057094,0 7.941989508488671,36.02957572035081,0 6.066151530925479,36.44547188061703,0 4.764423020986335,36.62392443513892,0 3.493677291437976,35.97515296631514,0 3.106925429160368,35.37041817825779,0 3.240667560794486,33.7305282548164,0 3.458685705208426,32.60728925928002,0 3.877135218933849,31.77419201004736,0 4.493176990059887,31.22863011282428,0 5.301819768677536,30.65586418173202,0 6.265321819052483,30.0691041224116,0 7.020796714785691,29.81875230899318,0 7.959915075760289,29.53855176549919,0 9.281843396006764,29.50548627267951,0 9.893768842088617,30.18926040640534,0 10.3830368744927,31.67020687109077,0 10.2377957939487,32.31792661375939,0 9.896741224926839,32.99654368443903,0 8.960966259802955,33.76308126842352,0 7.958737042214876,34.55858315047856,0 5.905276973666657,35.32160506007503,0 4.616616329105076,35.49932090115448,0 3.959974675918352,35.58770308272928,0 2.288429160270522,34.81701189629263,0 1.933597852314288,34.04536289707478,0 1.771715348654364,32.79905702965419,0 1.79528413723465,31.85637726897122,0 2.433770444050329,31.16163683520288,0 3.060257659332673,30.46687596606916,0 4.682927061210435,29.64886469639588,0 5.483318302829423,29.54496390760933,0 6.44232296103829,29.58197457821003,0 7.418185470035585,30.23245324044437,0 8.414322475138379,31.0296087579966,0 9.051463377110265,32.02958220706194,0 9.303468006744392,32.9299745216554,0 9.323600847861171,33.23987121535197,0 8.163131605416645,34.20443758623159,0 7.152614625978384,34.50818685838356,0 5.295581715265314,34.9153805173487,0 3.367131584311842,34.8490296830341,0 1.916857998089818,34.2094697325727,0 1.779632858967195,32.48464672814347,0 2.847665723769577,31.11518693875762,0 3.263817134778355,30.59916465272637,0 4.284391352666901,30.4759715994806,0 5.883594138015358,30.11550897154642,0 7.222028855941827,30.10296351076449,0 8.002371464697207,30.46442317299375,0 8.422529171143163,31.18419865875585,0 8.683240658444023,32.39531876216057,0 8.13170608172274,33.09863651967788,0 6.950726326695316,33.25692075304416,0 5.754656294404548,33.09247813129874,0 5.126879043145682,32.55080485081896,0 4.911709986966397,31.9545694107128,0 5.304433686538297,30.81109753368944,0 6.269535204024141,30.22383575132379,0 7.222028855941827,30.10296351076449,0 7.601760482920632,30.05267000492488,0 8.605507166036926,31.00240365032093,0 9.234164090068795,31.84661813605802,0 8.497731907916243,32.57807232939242,0 6.9394580060517,32.94551987370151,0 5.948897953026853,32.91282374431437,0 5.333901731909807,32.52274502489892,0 5.112952977806124,31.61572120398289,0 5.705169525277061,30.75834862151933,0 6.857509199493648,30.61622917486949,0 7.805025087758684,30.33596118053369,0 8.414322475138379,31.0296087579966,0 8.44731533026758,31.64833441507476,0 8.489250476095183,32.42299585402363,0 7.746173296264624,33.3080774797786,0 6.565060493459985,33.61907830249181,0 5.562668474410812,33.58586939494309,0 4.716498429217239,33.07473620631099,0 4.708602306898944,32.29372171290398,0 4.905943796504149,31.48712202926951,0 6.282259891261059,30.68850048940996,0 7.601760482920632,30.05267000492488,0 8.548096018588606,29.92188940323715,0 9.517623160254436,30.24627625625867,0 9.936279875922802,30.80475398441337,0 10.18101342092832,31.54597989535082,0 10.24927097315613,32.47246697795803,0 9.919103246227142,33.30601698654401,0 8.763943679157171,34.60357666478885,0 8.155076482008074,35.18177999107154,0 6.924058225554655,35.516159088386,0 4.804857498837953,35.96329235612153,0 4.144506889007378,36.05356601707385,0 2.381378091766586,36.11221419766891,0 1.575493669088615,35.38711733620852,0 1.408324488971644,34.91627557294287,0 1.498290916237062,34.09365623894755,0 2.406655033788085,32.72962763627595,0 3.463239859086957,31.66817805071899,0 5.097086616643116,30.52743891704995,0 5.883594138015358,30.11550897154642,0 6.641373068345957,29.86711588617368,0 7.589029454336407,29.74391709867475,0 8.343867688122513,29.64039441191366,0 9.675347470343752,29.75681288838466,0 10.86599721106438,30.50259020489695,0 11.07861368805025,30.77911067890154,0 11.35542146138304,31.8265248631299,0 11.27458899257073,33.08892477599748,0 10.74424779722198,33.80332992862582,0 9.96489263124259,34.41763161201401,0 8.561914842173007,34.95927248847883,0 7.137433805093981,35.16116394979614,0 5.912111627368011,35.15781351526715,0 4.668005727636091,34.67799584731791,0 4.258289678577962,34.40853893624888,0 3.666233158581358,33.36523597445866,0 3.458685705208426,32.60728925928002,0 3.671500349430996,31.17463489021786,0 4.285897568942105,30.78721888207427,0 5.492087681997351,30.00896080151549,0 6.820797530898616,29.53436321373602,0 7.387770270670419,29.46062732766785,0 8.753556663712834,30.20315251687913,0 9.149597241234233,30.45642931231679,0 9.767804805753297,31.14210569955944,0 10.04535397672082,32.34808648227221,0 10.26080108812013,32.62705462322149,0 10.15357907168419,33.90021693193403,0 9.958947329192899,34.09369114204767,0 8.764174044981708,34.92917162963514,0 7.540218161374661,35.43212387024065,0 6.299435554275625,35.76130348666395,0 5.242928919625389,35.90129081223144,0 4.144506889007378,36.05356601707385,0 3.520072392182108,35.64484404095064,0 2.915872020161332,35.06784339482222,0 2.814516312950184,33.7808613813339,0 2.824494752372226,32.99555187926774,0 3.460967203261227,32.13750754892369,0 4.493176990059887,31.22863011282428,0 5.304433686538297,30.81109753368944,0 7.043186064686395,30.43687963099781,0 8.002371464697207,30.46442317299375,0 8.406379040687991,30.87494862714616,0 8.665663540497938,32.08545267823758,0 8.709853566884574,32.86045545777722,0 8.13170608172274,33.09863651967788,0 7.35819921442282,33.51663610982168,0 5.764884801809491,33.56056023893437,0 5.55628187639871,33.27383931913467,0 5.119874247740723,32.08303394286622,0 5.515955139647193,31.24966788527376,0 5.714842394863049,31.22413287755767,0 19.11984178802782,11.14372039230692,0 18.59585192151631,11.54372661347288,0 18.06751203579498,11.94141977857949,0 17.26831521282578,11.79369470660152,0 17.40689876130436,11.02028936470319,0 17.61108989798324,9.918108240441365,0 18.06152356512109,9.222063024870515,0 18.28632446659189,8.873424534734323,0 19.01594540180122,8.730817128538435,0 19.59891786543273,8.615792689908624,0 20.64223470714698,9.169686000886147,0 20.45350174339363,9.664227215287548,0 19.82679128684168,10.24551200819137,0 18.87173062849905,10.73752815413694,0 17.84664724691515,10.93618956473773,0 17.0130325975584,10.64005980667623,0 16.27827913371289,10.15846487503156,0 15.95681981022486,9.449628750865387,0 15.97067351565362,8.836451007340376,0 16.3188374429128,8.320787906123567,0 16.92950071898821,7.607362979019396,0 17.47944342506919,7.34870104189551,0 18.46564715293798,7.004272651335818,0 19.33833365957308,6.833062811645052,0 20.06435032035977,6.689334043839279,0 20.92505438698083,7.129036308379173,0 21.35102667852564,7.654100131546003,0 21.77718694819049,8.177692526839286,0 21.94834515890568,8.904253357944841,0 22.0092036924661,9.803729726080768,0 21.71111393749744,10.47173608248848,0 20.97517087907893,11.22758039269638,0 19.981919771807,11.57319904092631,0 18.83609848495309,11.94400019642253,0 17.6808691930594,11.56804129583004,0 17.37329153036539,10.87506622676336,0 17.27255991514299,10.43891118744104,0 17.10497208764866,9.710516426758938,0 17.40975349255603,9.042735945094977,0 18.23031466292794,7.96799032851292,0 19.07082813348126,7.650705508545056,0 19.65277046760177,7.535844067041829,0 20.30185161433178,7.712411877951465,0 20.98448707622144,8.033471328893951,0 21.55596491354155,8.527621735115435,0 21.87202842443531,9.224160485967573,0 21.57394916746217,9.893065166806998,0 20.87244874579593,10.79426474433729,0 20.32327511472697,11.05639949536967,0 19.13086364337414,11.8873471694698,0 17.80262379303385,12.14001457743165,0 16.88492201538424,12.16195513809346,0 16.18707953926255,11.83257206875567,0 15.84661125016704,10.9905094128335,0 15.64140084308162,10.1115144593131,0 15.66974179188046,8.885576451047987,0 16.21648383154822,7.878530385821081,0 17.52486782689424,6.880741729775242,0 18.18580848656003,6.446302507898473,0 19.75009797748234,5.986199618502845,0 20.61924849684375,5.813591406031681,0 21.32524644381393,6.895577811738551,0 21.16360768762192,8.149868105255742,0 20.78762970451492,9.140386203804283,0 19.90463237783106,9.926069429203821,0 19.06252430383854,10.24461123068344,0 17.71195460594963,10.35488427929051,0 17.07150127858023,9.564634719238018,0 16.90435841824126,8.834309870020482,0 17.32148172644038,7.9908653845147,0 17.88315629804999,7.117590248366448,0 18.54392442652922,6.682778228840657,0 19.31483032824755,6.072092779516433,0 20.29587798947797,5.72487778077149,0 21.9528155364783,5.698828646845405,0 22.48716345882833,6.048792556352796,0 22.65654125206165,6.773333380168887,0 22.43125568815814,7.73884952498604,0 21.61630658426374,9.42857950900215,0 20.70149881760293,10.07030558680961,0 19.71482812031442,10.4196232325646,0 18.66863307813995,9.86555233375644,0 18.32001797399423,9.019418901021368,0 18.15170827845092,8.288900891691146,0 18.53291837338039,7.297231660330623,0 19.15924371782863,6.715253738551053,0 20.29587798947797,5.72487778077149,0 21.23148437189166,5.844109468097091,0 22.05514876298462,6.136597980645062,0 22.54080394165041,7.562878126559675,0 22.38969904750006,8.204538186301793,0 22.05883475035732,8.729377340768146,0 21.36855894125314,9.022698910990465,0 20.82175907524675,9.285746751593143,0 20.09407787492773,9.431852996452879,0 18.90389062785037,8.905381751809612,0 18.65671508458706,8.495946164004453,0 18.60024393907595,7.590043096396405,0 19.04759524689901,6.890293053639086,0 19.77408856212262,6.746934798355394,0 20.49932582487874,6.602670713302847,0 21.29117825196684,6.749613202172456,0 21.9296265924043,7.536510427049618,0 22.10070714064298,8.263911279057723,0 21.76134432867593,9.39890007129222,0 21.20648336053899,10.27160661664886,0 20.32327511472697,11.05639949536967,0 19.7720380291826,11.31682764225142,0 18.89027724889679,11.48739915205085,0 18.20723440949949,11.16989709629877,0 17.77927301640805,10.64569545225685,0 17.5774959459667,9.772374065767563,0 17.73562583470128,9.132562205733754,0 18.21898857037543,8.581272558467163,0 19.17218976338345,8.08931170296937,0 19.96772084359635,8.23726857356213,0 20.32652674802646,8.470896847876865,0 20.82175907524675,9.285746751593143,0 20.8900527668688,9.576251826114714,0 20.91545423866005,10.33068904712456,0 20.61510007456256,10.99772537416755,0 20.09703758566211,11.40192179948338,0 19.50972868682711,11.51657051188542,0 18.74309288170012,11.51559689639143,0 18.06067201607198,11.1981596622792,0 17.59913393706421,10.52841286497463,0 17.46473380652331,9.946163530467002,0 17.70204397823044,8.986528068270996,0 17.96062429952385,8.784017906667987,0 18.62298558780246,8.349826404228056,0 19.49725525272471,8.177914980590332,0 20.32652674802646,8.470896847876865,0 20.67634327102809,9.315069932091992,0 20.34195065634851,9.838684084375945,0 19.25296963749612,9.75093251546069,0 18.46603564718907,8.990991314922068,0 18.40977645400968,8.085887588467092,0 18.89149491296025,7.532997744303139,0 19.32808050879747,7.447106794312973,0 20.30185161433178,7.712411877951465,0 20.18111653844813,8.499975359322123,0 19.63283342501877,8.761639183200693,0 19.53112699298702,8.323929285175881,0 41.39609689000207,25.41180335409772,0 40.38595927052877,26.00120041049993,0 39.79715751528924,26.31355397135132,0 39.21076785243851,26.62599174858159,0 38.57680393887471,26.80071635129337,0 37.93553767049013,26.50058096482673,0 37.34904113311985,25.86971851409844,0 37.23978704326386,25.11283354689867,0 37.44279293781504,24.27328732643019,0 37.79676676474659,23.39267635036121,0 38.60642928702309,22.38593496966233,0 39.37350191508338,22.17053165306999,0 39.68821146085092,22.54910285036963,0 40.2884983309572,23.17322479265805,0 41.47497972362743,24.75208931007982,0 41.335458412513,25.26878488641769,0 40.91253010870333,25.54271788012914,0 40.10592895240249,25.7569288333446,0 38.8284586957467,26.09900997596298,0 38.4499849421963,25.5715943036104,0 38.3404665949918,25.28625627690673,0 38.63624261114687,24.25883191902456,0 39.29937772598368,23.75643534573566,0 40.03059817171545,23.40130479714562,0 41.63005456509831,23.43512437978895,0 43.10855566105234,23.97093452448009,0 43.80703786817258,24.73129234453246,0 44.12878243724528,25.44302867031859,0 44.19561710875222,26.39244766956327,0 43.14829828942432,27.33512881432586,0 42.65556663510328,27.47120112545757,0 41.66844020387396,27.73759758139109,0 39.53121639726765,26.54042317942681,0 39.50555616125005,25.5962385431535,0 40.55523906967873,24.68457763512284,0 41.41458499988185,24.60934422117625,0 41.69590706963388,24.85059957281598,0 42.26308341656751,25.33253721365675,0 42.51243472369605,25.9042151287609,0 42.60176499293889,26.5216163122123,0 41.9110708641683,27.03161281578811,0 40.82549547974205,27.47964326349608,0 39.45234148553679,27.67079312170207,0 38.42581582122617,27.31618431334584,0 37.88631272882717,26.82939680312793,0 37.50659702335392,25.82765314604865,0 37.70894647016711,24.98640554543207,0 38.06320463133811,24.10352440457879,0 39.23331206430446,23.1458674168606,0 40.0732954598471,23.07411336434934,0 40.89710890475024,23.7978188865665,0 41.35435819627607,24.46665393221269,0 41.43565398799884,25.08186218047215,0 40.9726788781102,25.68590393180796,0 39.95928752576393,26.27162998823946,0 38.67962720090449,26.61443470776293,0 37.40917903467484,26.95620374489145,0 36.61286349466899,25.74969063358416,0 36.71755611996675,25.09470564514409,0 37.49217810260744,23.94625495665487,0 39.02550620401306,23.04810447829816,0 39.48758485907125,22.91776638862848,0 41.01560075226303,24.08275354985153,0 41.43565398799884,25.08186218047215,0 41.90254949205479,25.75257840689372,0 41.25538982955039,25.92883520378886,0 40.01835362024016,26.41518574877455,0 38.60687101395077,25.52831425183068,0 38.48904478310517,24.77234859008057,0 39.91582005650986,23.11691102313329,0 40.48759178836722,22.80273240787913,0 41.6682631803868,23.10651557283611,0 42.15252433681499,24.24407112189231,0 41.87928249057285,25.27912240284374,0 40.9726788781102,25.68590393180796,0 40.10592895240249,25.7569288333446,0 39.55060441410915,25.26793114826392,0 39.10078258366639,24.12804949537596,0 39.71473530285679,23.48650367383253,0 41.76607240464496,22.91998449054508,0 42.79838906329884,23.26105270763452,0 43.20509493508362,23.78275357273059,0 43.93520925124305,25.01589130448553,0 43.87058622740827,25.67935680558766,0 43.25282902899319,26.33939055942032,0 42.1128039516459,26.65616127251006,0 41.11339747024459,26.4458811286238,0 40.48812372710864,25.81514679577046,0 39.97364510717502,24.99851624710104,0 39.74173269732312,24.42671487934357,0 40.04541006925063,23.87125597813025,0 41.25391943546302,23.38161741258272,0 41.90904806191055,23.67479602942472,0 42.87954680967997,24.67781846441537,0 43.3555515264601,25.344549875513,0 43.44938279439104,25.96151407723944,0 41.7865556342486,26.74482880931491,0 41.29680991918004,26.87627050054149,0 40.19658403532392,26.84606074958657,0 39.31236760177467,26.43924503255565,0 38.76365605711932,25.48486589588523,0 38.90085452106391,24.49972669910602,0 39.91582005650986,23.11691102313329,0 41.16322212441406,22.30310599940703,0 42.11274398135325,22.03801966382943,0 42.65015674631742,22.50733258731173,0 43.11450998873873,23.16914180282915,0 43.3933435390873,24.20899974162835,0 43.03310454049003,25.43657272669011,0 42.31325642994248,26.2803452153857,0 41.0723896433195,26.77613609430519,0 39.92972591123547,27.07370427019657,0 39.10881785730953,26.81269317715821,0 38.60687101395077,25.52831425183068,0 38.64477037049748,24.72904507508148,0 39.56953397757119,23.99852910018122,0 40.46269808093798,23.59993341703869,0 41.49282568965849,23.95071122318341,0 42.11532437913517,24.57402013942969,0 42.48645523774707,25.43031114675135,0 42.17542174726509,26.79945002637184,0 41.62334921964542,26.78885129774629,0 40.56523297173149,26.43155942849521,0 39.66652409313758,25.55446600877451,0 39.48033546542954,24.6537341564377,0 40.79734552874881,23.98385770195605,0 42.15252433681499,24.24407112189231,0 42.78173830889246,24.86600772532881,0 43.22346867054203,25.86484049241914,0 42.47574836519961,26.23539309544195,0 41.05420131160184,25.02658779672244,0 40.81558931355801,24.45521415237063,0";
     Map<Integer, Cluster> map = new HashMap<Integer,Cluster>();
     ArrayList<Placemark> p_arr = new ArrayList<Placemark>();
     
     loadData(data, p_arr);
     print(data);
    
    /* for (int i = 0; i < 3; i++) {
	    	System.out.println("--------------------------------"+p_arr.size());
	    	if(p_arr.size() == 0)
	    		break;
	    	Object[] c_rem = cluster(i,p_arr);
			map.put(i, (Cluster)c_rem[0]);
			p_arr = (ArrayList<Placemark>)c_rem[1];
	       }
     for(int id : map.keySet()) {
	    	System.out.println("********* "+id+" = "+map.get(id).cluster.size());
	    	System.out.println(map.get(id));
	       }
    
*/
	}
	
	public static void loadData(String data, ArrayList<Placemark> p_arr){
		
		String[] s = data.split(" ");
		double lat = 0;
		double lon = 0;
		String [] str = null;
		
		  for(String st: s){
			
		   str = st.split(",");	
		   lat = Double.parseDouble(str[0]);	
		   lon = Double.parseDouble(str[1]);	
		   p_arr.add(new Placemark(lat, lon));
		  }
		
	}
	public static double distEuclid(Placemark a, Placemark b){
		double metric_de = 0;
		double dx = 0;
	    double dy = 0;
	//System.out.println(""+a.x+","+a.y+","+b.x+","+b.y);
			
	        dx = b.lat - a.lat;
			//System.out.println(""+dx);
			dy = b.lon - a.lon;
			//System.out.println(","+dy);
		 metric_de = Math.sqrt(((dx*dx)+(dy*dy)));	
		
		return metric_de;
	}
	
public static Object[] cluster(int id, ArrayList<Placemark>arr){
		
		Cluster c1 = new Cluster(id);
		
		ArrayList<Placemark> rem_points =  new ArrayList<Placemark>();
		double d = 15.0;
		
		c1.cluster.add(arr.get(0));
		
		for(int i = 1; i < arr.size(); i++){
			if (Placemark.distEuclid(arr.get(0), arr.get(i)) < d) {
				c1.cluster.add(arr.get(i));
				
			}
			else rem_points.add(arr.get(i));
		}
		return new Object[]{c1,rem_points};
	}

	
	public static void print(String data)throws Exception{
	
	String[] COLORS = {"ff0000ff", "ff00ff00", "ffff0000", "ffffff00"};	
	
	ArrayList<Placemark> p_arr = new ArrayList<Placemark>();	
	Map<Integer, Cluster> map = new HashMap<Integer,Cluster>();
	PrintWriter out = new PrintWriter(new FileWriter(new File("FileStampato.kml")));	
	
	loadData(data, p_arr);
	
	 for (int i = 0; i < 4; i++) {
	    	System.out.println("--------------------------------"+p_arr.size());
	    	if(p_arr.size() == 0)
	    		break;
	    	Object[] c_rem = cluster(i,p_arr);
			map.put(i, (Cluster)c_rem[0]);
			p_arr = (ArrayList<Placemark>)c_rem[1];
	       }
	
	 for(int id : map.keySet()) {
	    	System.out.println("********* "+id+" = "+map.get(id).cluster.size());
	    	System.out.println(map.get(id));
	       }
	 
	    out.println("<?xml version=\"1.0\" encoding=\"UTF-8\"?>");
		out.println("<kml>");
		out.println("<Document>");
	 for(int i = 0; i < COLORS.length; i++){
		out.println("<Style id=\""+COLORS[i]+"\">");
		out.println("<IconStyle>");
		out.println("<color>"+COLORS[i]+"</color>");
		out.println("<scale>1.2</scale>");
		out.println("<Icon>");
		out.println("<href>http://maps.google.com/mapfiles/kml/shapes/shaded_dot.png</href>");
		out.println("</Icon>");
		out.println("</IconStyle>");
		out.println("<ListStyle>");
		out.println("</ListStyle>");
		out.println("</Style>");
	}	
		int k = 0;
	  for(Cluster c: map.values()){
		 
		  k++;
			if (k == 4){
				k=0;     // cosi non mi da ArrayIndexOutOfBounds
			}
		  for (int i = 0; i < c.cluster.size(); i++) {
				
				out.println("<Placemark>");
				out.println("<styleUrl>#"+COLORS[k]+"</styleUrl>");
				out.println("<Point>");
		        out.print(" <coordinates>"+c.cluster.get(i)+",0 </coordinates>");
		        out.println("</Point>");
				out.println("</Placemark>");
			}
		   
	   }
	         out.println("</Document>");
		     out.println("</kml>");
		     out.close();
	}	
	
}
